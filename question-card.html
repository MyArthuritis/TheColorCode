<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/core-pages/core-pages.html">
<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="bower_components/core-icons/core-icons.html">
<link rel="import" href="bower_components/paper-progress/paper-progress.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-radio-group/paper-radio-group.html">

<polymer-element name="question-card">
    <template>
        <style type="text/css">
        .card {
            width: 512px;
            margin: 64px auto 0;
            border-radius: 3px;
            overflow: hidden;
            box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        }
        .card > core-toolbar {
            font-size: 18px;
            background-color: #03A9F4;
            color: #fff;
            line-height: 26px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }
        .card > core-toolbar > .question {
            padding: 0 8px;
        }
        .card > core-toolbar > paper-fab {
            position: absolute !important;
            top: 164px;
            right: 1em;
            z-index: 1;
            background-color: #f5f5f5;
            color: #626262;
        }
        .card > core-toolbar > paper-fab .answered {
            display: block !important;
        }
        .card > .answers {
            padding: 16px;
            background-color: #fff;
        }
        paper-radio-button::shadow #ink[checked] {
            color: #03A9F4;
        }
        paper-radio-button::shadow #onRadio {
            background-color: #03A9F4;
        }

        paper-radio-button[checked]::shadow #offRadio {
            border-color: #03A9F4;
        }
        .card > paper-progress {
            width: 100%;
        }
        .card > paper-progress::shadow #activeProgress {
            background-color: #03A9F4;
        }
        </style>
        <core-ajax auto url="questions.json" handleAs="json" on-core-response="{{handleResponse}}"></core-ajax>
        <core-a11y-keys target="{{}}" keys="enter" on-keys-pressed="{{nextQuestion}}"></core-a11y-keys>
        <core-pages selected="0">
            <section>
                <div class="card" vertical layout>
                    <core-toolbar class="tall">
                        <div class="question middle" flex>{{question}}</div>
                        <paper-fab icon="check" on-click="{{nextQuestion}}" style="visibility: {{displayFab}}"></paper-fab>
                    </core-toolbar>
                    <div class="answers">
                        <paper-radio-group vertical layout
                            id="answersRadioGroup"
                            selected="{{selectedAnswer}}"
                            on-change="{{questionAnswered}}"
                            excludedLocalNames="paper-icon-button">
                            <paper-radio-button name="red" label="{{redAnswer}}"></paper-radio-button>
                            <paper-radio-button name="blue" label="{{blueAnswer}}"></paper-radio-button>
                            <paper-radio-button name="white" label="{{whiteAnswer}}"></paper-radio-button>
                            <paper-radio-button name="yellow" label="{{yellowAnswer}}"></paper-radio-button>
                        </paper-radio-group>
                    </div>
                    <paper-progress value="{{progress}}" min="0" max="45"></paper-progress>
                </div>
            </section>
        </core-pages>
    </template>
    <script type="text/javascript">
    (function() {
        var number = 0;
        var redAnswers = 0;
        var blueAnswers = 0;
        var whiteAnswers = 0;
        var yellowAnswers = 0;

        Polymer('question-card', {
            created: function() {
                this.question = "Loading";
                this.redAnswer = "Loading";
                this.blueAnswer = "Loading";
                this.whiteAnswer = "Loading";
                this.yellowAnswer = "Loading";
                this.progress = 0;
                this.displayFab = "hidden";
            },
            ready: function() {
                console.log("READY!!!");
                //console.log(this.answers);   
            },
            publish: function() {
            },
            updateContent: function() {
                if (number <= 44) {
                    this.question = this.data[number].question;
                    this.redAnswer = this.data[number].choices[0].answer;
                    this.blueAnswer = this.data[number].choices[1].answer;
                    this.whiteAnswer = this.data[number].choices[2].answer;
                    this.yellowAnswer = this.data[number].choices[3].answer;
                    this.progress = number + 1;
                    console.log("Now on question number: ",this.progress);   
                } else {
                    this.question = "Done!";
                    this.redAnswer = "Red: "+redAnswers;
                    this.blueAnswer = "Blue: "+blueAnswers;
                    this.whiteAnswer = "White: "+whiteAnswers;
                    this.yellowAnswer = "Yellow: "+yellowAnswers;
                }
            },
            handleResponse: function(e) {
                this.data = e.detail.response;
                this.updateContent();
                //console.log(red);
            },
            questionAnswered: function() {
                this.displayFab = "visible";
            },
            nextQuestion: function() {
                if (number <= 44) { 
                    number++;
                    if (this.selectedAnswer == "red") {
                        redAnswers++;
                        //console.log("red selected");
                    } else if (this.selectedAnswer == "blue") {
                        blueAnswers++;
                        //console.log("blue selected");
                    } else if (this.selectedAnswer == "white") {
                        whiteAnswers++;
                        //console.log("white selected");
                    } else if (this.selectedAnswer == "yellow") {
                        yellowAnswers++;
                        //console.log("yellow selected");
                    } 
                    console.log("Selected Answer: ",this.selectedAnswer,
                              "\nRed:    ",redAnswers, 
                              "\nBlue:   ",blueAnswers, 
                              "\nWhite:  ",whiteAnswers, 
                              "\nYellow: ",yellowAnswers);
                }
                this.updateContent();
                this.displayFab = "hidden";
                this.selectedAnswer = null;
            }
        });
    })();
    </script>
</polymer-element>

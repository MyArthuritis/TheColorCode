<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/core-pages/core-pages.html">
<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="bower_components/core-icons/core-icons.html">
<link rel="import" href="bower_components/paper-progress/paper-progress.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">

<polymer-element name="question-card">
    <template>
        <style type="text/css">
        .card {
            width: 640px;
            margin: 64px auto 0;
            border-radius: 3px;
            overflow: hidden;
            box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.16), 0px 2px 5px 0px rgba(0, 0, 0, 0.23);
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
        }
        .card > core-toolbar {
            background-color: #03A9F4;
            color: #fff;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }
        .card > core-toolbar > .question {
            padding: 32px
            font-size: 20px;
            line-height: 32px;
            font-weight: 400;
        }
        .card > core-toolbar > paper-fab {
            position: absolute !important;
            top: 164px;
            right: 1em;
            z-index: 1;
            background-color: #f5f5f5;
            color: #626262;
        }
        .card > core-toolbar > paper-fab .answered {
            display: block !important;
        }
        .card > core-pages {
            height: 292px;
        }
        .card > core-pages > .answers {
            padding: 32px;
            background-color: #fff;
        }
        .card > core-pages > .answers > paper-radio-group > paper-radio-button {
            /* Breaks larger answers
            height: 24px;*/
        }
        paper-radio-button::shadow #ink[checked] {
            color: #03A9F4;
        }
        paper-radio-button::shadow #onRadio {
            background-color: #03A9F4;
        }
        paper-radio-button[checked]::shadow #offRadio {
            border-color: #03A9F4;
        }
        .card > core-pages > .answers > div > paper-icon-button {
            color: #CCC;
            padding: 12px;
        } 
        .card > core-pages > .definition {
            padding: 32px;
            background-color: #444;
            color: #fff;
        }
        .card > core-pages > .definition > paper-icon-button {
            position: absolute;
            top: 16px;
            left: 16px;
        }
        .card > core-pages > .definition > h2 {
            padding: 16px 0px;
        }
        .card > core-pages > .completed {
            padding: 32px;
        }
        .card > paper-progress {
            width: 100%;
        }
        .card > paper-progress::shadow #activeProgress {
            background-color: #03A9F4;
        }
        .card > paper-progress::shadow #progressContainer {
            background-color: #fff;
        }
        </style>
        <core-ajax auto url="questions.json" handleAs="json" on-core-response="{{handleResponse}}"></core-ajax>
        <core-a11y-keys target="{{}}" keys="enter" on-keys-pressed="{{nextQuestion}}"></core-a11y-keys>
        <div class="card" vertical layout>
            <core-toolbar class="tall">
                <h4 class="question middle" flex>{{question}}</h4>
                <paper-fab icon="check" on-click="{{nextQuestion}}" style="visibility: {{displayFab}}"></paper-fab>
            </core-toolbar>
            <core-pages selected="{{currentPage}}">
                <div class="answers" horizontal layout center>
                    <paper-radio-group vertical layout flex id="answersRadioGroup" selected="{{selectedAnswer}}" on-change="{{questionAnswered}}">
                        <paper-radio-button name="red" label="{{redAnswer}}"></paper-radio-button>
                        <paper-radio-button name="blue" label="{{blueAnswer}}"></paper-radio-button>
                        <paper-radio-button name="white" label="{{whiteAnswer}}"></paper-radio-button>
                        <paper-radio-button name="yellow" label="{{yellowAnswer}}"></paper-radio-button>
                    </paper-radio-group>
                    <div vertical layout style="display: {{displayDefinitions}}">
                        <paper-icon-button icon="info-outline" on-click="{{switchToRedDefinition}}"></paper-icon-button>
                        <paper-icon-button icon="info-outline" on-click="{{switchToBlueDefinition}}"></paper-icon-button>
                        <paper-icon-button icon="info-outline" on-click="{{switchToWhiteDefinition}}"></paper-icon-button>
                        <paper-icon-button icon="info-outline" on-click="{{switchToYellowDefinition}}"></paper-icon-button>
                    </div>
                </div>
                <div class="definition">
                    <paper-icon-button icon="arrow-back" on-click="{{switchBackToAnswers}}"></paper-icon-button>
                    <h2>{{definedWord}}:</h2>
                    <div>{{definitionOfWord}}</div>
                </div>
                <div class="completed">

                </div>
            </core-pages>
            <paper-progress value="{{progress}}" min="0" max="45"></paper-progress>
        </div>
    </template>
    <script type="text/javascript">
    (function() {
        var number = 0;
        var redAnswers = 0;
        var blueAnswers = 0;
        var whiteAnswers = 0;
        var yellowAnswers = 0;

        Polymer('question-card', {
            created: function() {
                this.currentPage = 0;
                this.question = "Loading";
                this.redAnswer = "Loading";
                this.blueAnswer = "Loading";
                this.whiteAnswer = "Loading";
                this.yellowAnswer = "Loading";
                this.progress = 0;
                this.displayFab = "hidden";
                this.displayDefinitions = "none";
            },
            ready: function() {
                console.log("READY!!!");
                //console.log(this.answers);   
            },
            publish: function() {},
            updateContent: function() {
                if (number <= 44) {
                    this.question = this.data[number].question;
                    this.redAnswer = this.data[number].choices[0].answer;
                    this.blueAnswer = this.data[number].choices[1].answer;
                    this.whiteAnswer = this.data[number].choices[2].answer;
                    this.yellowAnswer = this.data[number].choices[3].answer;
                    this.progress = number + 1;
                    console.log("Now on question number: ", this.progress);
                } else {
                    this.question = "Done!";
                    this.redAnswer = "Red: " + redAnswers;
                    this.blueAnswer = "Blue: " + blueAnswers;
                    this.whiteAnswer = "White: " + whiteAnswers;
                    this.yellowAnswer = "Yellow: " + yellowAnswers;
                }
                if (this.question == "Which word described me best when I was a child?") {
                    this.displayDefinitions = "flex";
                } else {
                    this.displayDefinitions = "none";
                }
            },
            handleResponse: function(e) {
                this.data = e.detail.response;
                this.updateContent();
                //console.log(red);
            },
            questionAnswered: function() {
                if (number <= 44) this.displayFab = "visible";
            },
            nextQuestion: function() {
                if (number <= 44) {
                    number++;
                    if (this.selectedAnswer == "red") {
                        redAnswers++;
                        //console.log("red selected");
                    } else if (this.selectedAnswer == "blue") {
                        blueAnswers++;
                        //console.log("blue selected");
                    } else if (this.selectedAnswer == "white") {
                        whiteAnswers++;
                        //console.log("white selected");
                    } else if (this.selectedAnswer == "yellow") {
                        yellowAnswers++;
                        //console.log("yellow selected");
                    }
                    console.log("Selected Answer: ", this.selectedAnswer,
                        "\nRed:    ", redAnswers,
                        "\nBlue:   ", blueAnswers,
                        "\nWhite:  ", whiteAnswers,
                        "\nYellow: ", yellowAnswers);
                }
                this.updateContent();
                this.displayFab = "hidden";
                this.selectedAnswer = null;
            },
            switchToRedDefinition: function() {
                this.currentPage = 1;
                this.definedWord = this.redAnswer;
                this.definitionOfWord = this.data[number].choices[0].definition;
            },
            switchToBlueDefinition: function() {
                this.currentPage = 1;
                this.definedWord = this.blueAnswer;
                this.definitionOfWord = this.data[number].choices[1].definition;
            },
            switchToWhiteDefinition: function() {
                this.currentPage = 1;
                this.definedWord = this.whiteAnswer;
                this.definitionOfWord = this.data[number].choices[2].definition;
            },
            switchToYellowDefinition: function() {
                this.currentPage = 1;
                this.definedWord = this.yellowAnswer;
                this.definitionOfWord = this.data[number].choices[3].definition;
            },
            switchBackToAnswers: function() {
                this.currentPage = 0;
            }
        });
    })();
    </script>
</polymer-element>
